flowchart TD
    A[ðŸ“ User Uploads Excel File] --> B{âœ… Validations}
    
    B -->|Allowed Extension: .xls / .xlsx| C[ðŸ“¥ Accept File]
    B -->|âŒ Invalid Extension or Size| B1[âš ï¸ Show Error Message]
    B1 --> B2[ðŸš« Reject Upload]

    C --> D{ðŸ“¦ Macro Check}
    D -->|âŒ Macro Detected| D1[ðŸš« Reject File + Notify]
    D -->|âœ… No Macro| E{ðŸ›¡ï¸ Virus Scan}
    
    E -->|âŒ Virus Found| E1[ðŸš« Reject File + Alert]
    E -->|âœ… Clean| F[ðŸ§  Extract Metadata]

    F --> G{ðŸ’¾ Save To}
    G -->|ðŸ“¦ S3 Bucket| H1[S3 Upload]
    G -->|ðŸ—‚ï¸ Database| H2[Insert into DB with Document ID]

    H1 --> I[ðŸ“ Save Document ID + Metadata in DB]
    H2 --> I

    I --> J[âœ… Upload Complete!]
    J --> K[ðŸ” Role Check for Access]

    K -->|User Has Permission| L[â¬‡ï¸ Allow Download]
    K -->|Unauthorized| M[â›” Show Access Denied]
